<div class="p-8 space-y-8 animate-fade-in bg-transparent min-h-screen">

  <!-- ===== PRODUCT MODAL ===== -->
  @if (showProductModal) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
      <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg p-8 relative">
        <button (click)="closeModals()" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 text-xl">‚úï</button>
        <h2 class="text-xl font-black text-[#1a2e1a] mb-6">{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h2>
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Name *</label>
              <input [(ngModel)]="productForm.name" type="text" placeholder="Product name"
                     class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#2C4A3C]/20">
            </div>
            <div>
              <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">SKU</label>
              <input [(ngModel)]="productForm.sku" type="text" placeholder="e.g. TENT-001"
                     class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
            </div>
          </div>
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Category</label>
            <select [(ngModel)]="productForm.categoryId"
                    class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
              <option value="">Select category...</option>
              @for (cat of categories; track cat.id) {
                <option [value]="cat.id">{{ cat.name }}</option>
              }
            </select>
          </div>
          <div class="grid grid-cols-3 gap-4">
            <div>
              <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Price (DT) *</label>
              <input [(ngModel)]="productForm.price" type="number" min="0" placeholder="0.00"
                     class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
            </div>
            <div>
              <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Rental/wk</label>
              <input [(ngModel)]="productForm.rentalPrice" type="number" min="0" placeholder="0.00"
                     class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
            </div>
            <div>
              <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Stock</label>
              <input [(ngModel)]="productForm.stockQuantity" type="number" min="0" placeholder="0"
                     class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
            </div>
          </div>
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Description</label>
            <textarea [(ngModel)]="productForm.description" rows="3" placeholder="Product description..."
                      class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none resize-none"></textarea>
          </div>
          <div class="flex items-center gap-3">
            <input [(ngModel)]="productForm.isActive" type="checkbox" id="isActive" class="w-4 h-4 accent-[#2C4A3C]">
            <label for="isActive" class="text-sm font-bold text-gray-600">Active / Available for sale</label>
          </div>
        </div>
        <div class="flex gap-3 mt-6">
          <button (click)="saveProduct()"
                  class="flex-1 py-3 bg-[#2C4A3C] text-white rounded-xl text-sm font-black uppercase tracking-widest hover:bg-[#1a2e1a] transition-all">
            {{ isEditMode ? '‚úì Update Product' : '+ Add Product' }}
          </button>
          <button (click)="closeModals()"
                  class="px-6 py-3 bg-gray-100 text-gray-600 rounded-xl text-sm font-bold hover:bg-gray-200 transition-all">Cancel</button>
        </div>
      </div>
    </div>
  }

  <!-- ===== CATEGORY MODAL ===== -->
  @if (showCategoryModal) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
      <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-8 relative">
        <button (click)="closeModals()" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 text-xl">‚úï</button>
        <h2 class="text-xl font-black text-[#1a2e1a] mb-6">{{ isEditMode ? 'Edit Category' : 'Add New Category' }}</h2>
        <div class="space-y-4">
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Name *</label>
            <input [(ngModel)]="categoryForm.name" type="text" placeholder="Category name"
                   class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#2C4A3C]/20">
          </div>
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Description</label>
            <input [(ngModel)]="categoryForm.description" type="text" placeholder="Short description"
                   class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
          </div>
          <div>
            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Icon (emoji)</label>
            <input [(ngModel)]="categoryForm.icon" type="text" placeholder="üì¶"
                   class="w-full mt-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none">
          </div>
        </div>
        <div class="flex gap-3 mt-6">
          <button (click)="saveCategory()"
                  class="flex-1 py-3 bg-[#2C4A3C] text-white rounded-xl text-sm font-black uppercase tracking-widest hover:bg-[#1a2e1a] transition-all">
            {{ isEditMode ? '‚úì Update Category' : '+ Add Category' }}
          </button>
          <button (click)="closeModals()"
                  class="px-6 py-3 bg-gray-100 text-gray-600 rounded-xl text-sm font-bold hover:bg-gray-200 transition-all">Cancel</button>
        </div>
      </div>
    </div>
  }

  <!-- ===== HEADER ===== -->
  <div class="flex justify-between items-center">
    <div>
      @if (activePortalSection === 'products_categories') {
        <h1 class="text-2xl font-black text-[#1a2e1a]">
          {{ activeTab === 'categories' ? 'Category Management' : 'Product Catalog' }}
        </h1>
        <p class="text-sm text-[#617152] font-medium">
          {{ activeTab === 'categories' ? 'Organize your product catalog' : 'Showing all products' }}
        </p>
      } @else if (activePortalSection === 'inventory') {
        <h1 class="text-2xl font-black text-[#1a2e1a]">Inventory & Warehouse Management</h1>
        <p class="text-sm text-[#617152] font-medium">Manage stock levels, movements, and warehouse locations</p>
      } @else if (activePortalSection === 'orders') {
        <h1 class="text-2xl font-black text-[#1a2e1a]">Orders Management</h1>
        <p class="text-sm text-[#617152] font-medium">Monitor equipment transactions and deployments.</p>
      } @else if (activePortalSection === 'rentals_management') {
        <h1 class="text-2xl font-black text-[#1a2e1a]">Rentals Management</h1>
        <p class="text-sm text-[#617152] font-medium">Track active rentals and manage returns</p>
      }
    </div>
    <div class="flex gap-3">
      @if (activePortalSection === 'products_categories') {
        <button (click)="activeTab === 'categories' ? openAddCategory() : openAddProduct()"
                class="px-4 py-2 bg-[#2C4A3C] text-white rounded-lg text-sm font-bold hover:bg-[#1a2e1a] transition-all shadow-sm flex items-center gap-2">
          <span>+</span> {{ activeTab === 'categories' ? 'Add Category' : 'Add Product' }}
        </button>
      } @else if (activePortalSection === 'inventory') {
        <button (click)="recordMovement()"
                class="px-4 py-2 bg-[#2C4A3C] text-white rounded-lg text-sm font-bold hover:bg-[#1a2e1a] transition-all shadow-sm flex items-center gap-2">
          <span>+</span> Record Movement
        </button>
      }
    </div>
  </div>

  <!-- ===== PRODUCTS & CATEGORIES ===== -->
  @if (activePortalSection === 'products_categories') {
    <div class="flex bg-white/50 p-1 rounded-xl border border-gray-100 shadow-sm max-w-fit">
      <button (click)="activeTab = 'categories'"
              class="px-8 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center gap-2"
              [ngClass]="activeTab === 'categories' ? 'bg-[#2C4A3C] text-white shadow-lg' : 'text-gray-500 hover:bg-white'">
        <span class="text-xs">üè∑Ô∏è</span> Categories
      </button>
      <button (click)="activeTab = 'products'"
              class="px-8 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center gap-2"
              [ngClass]="activeTab === 'products' ? 'bg-[#2C4A3C] text-white shadow-lg' : 'text-gray-500 hover:bg-white'">
        <span class="text-xs">üì¶</span> Products
      </button>
    </div>

    @if (activeTab === 'categories') {
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        @for (cat of categories; track cat.id) {
          <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-all group relative">
            <div class="absolute top-4 right-4 flex gap-2">
              <button (click)="openEditCategory(cat)" class="text-gray-300 hover:text-blue-500 transition-colors text-lg" title="Edit">‚úèÔ∏è</button>
              <button (click)="deleteCategory(cat.id)" class="text-gray-300 hover:text-red-500 transition-colors text-lg" title="Delete">üóëÔ∏è</button>
            </div>
            <div class="flex items-center gap-4 mb-6">
              <div class="w-12 h-12 bg-gray-50 rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform">
                {{ cat.icon }}
              </div>
              <div>
                <h3 class="font-black text-[#1a2e1a] text-lg leading-tight">{{ cat.name }}</h3>
                <p class="text-xs text-gray-400 font-bold uppercase tracking-tighter">{{ cat.description }}</p>
              </div>
            </div>
            <div class="bg-gray-50/50 rounded-xl p-4 mb-6 flex justify-between items-center border border-gray-100">
              <span class="text-xs font-bold text-gray-500">Products</span>
              <span class="text-lg font-black text-[#1a2e1a]">{{ cat.count }}</span>
            </div>
            @if (cat.subcategories?.length) {
              <div class="mb-6 space-y-2">
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Subcategories:</p>
                @for (sub of cat.subcategories; track sub) {
                  <div class="bg-white border border-gray-100 rounded-lg px-4 py-2 text-xs font-bold text-[#1a2e1a]">{{ sub }}</div>
                }
              </div>
            }
            <button (click)="openAddProduct(); productForm.categoryId = cat.id; activeTab = 'products'"
                    class="w-full py-3 bg-[#2C4A3C] text-white rounded-xl text-xs font-black uppercase tracking-widest hover:bg-[#1a2e1a] transition-all flex items-center justify-center gap-2">
              <span>+</span> Add Product to this Category
            </button>
          </div>
        }
        @if (!categories.length) {
          <div class="col-span-2 text-center py-20 text-gray-400">
            <p class="text-4xl mb-4">üè∑Ô∏è</p>
            <p class="font-bold">No categories yet. Add your first one!</p>
          </div>
        }
      </div>

    } @else {
      <!-- Products Table -->
      <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
        <div class="p-6 border-b border-gray-50 bg-gray-50/20 flex gap-4">
          <div class="relative flex-1">
            <input type="text" [(ngModel)]="productSearch" (input)="filterProducts()" placeholder="Search products..."
                   class="w-full pl-10 pr-4 py-2 bg-white border border-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#2C4A3C]/10 transition-all">
            <span class="absolute left-3 top-2.5 opacity-30">üîç</span>
          </div>
          <select [(ngModel)]="selectedCategoryFilter" (change)="filterProducts()"
                  class="px-4 py-2 bg-white border border-gray-100 rounded-xl text-sm font-bold text-[#1a2e1a] focus:outline-none">
            <option value="">All Categories</option>
            @for (cat of categories; track cat.id) {
              <option [value]="cat.name">{{ cat.name }}</option>
            }
          </select>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
            <tr class="bg-gray-50/50 border-b border-gray-100 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">
              <th class="px-8 py-5">SKU</th>
              <th class="px-8 py-5">Product Name</th>
              <th class="px-8 py-5">Category</th>
              <th class="px-8 py-5">Price</th>
              <th class="px-8 py-5">Rental</th>
              <th class="px-8 py-5 text-center">Stock</th>
              <th class="px-8 py-5 text-center">Status</th>
              <th class="px-8 py-5 text-right">Actions</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
              @for (prod of filteredProducts; track prod.id) {
                <tr class="hover:bg-gray-50/30 transition-colors group">
                  <td class="px-8 py-6 text-[10px] font-black text-gray-400 uppercase tracking-widest">{{ prod.sku }}</td>
                  <td class="px-8 py-6">
                    <p class="font-bold text-[#1a2e1a]">{{ prod.name }}</p>
                    <p class="text-[10px] text-gray-400 italic font-medium">{{ prod.description }}</p>
                  </td>
                  <td class="px-8 py-6">
                    <span class="text-xs font-bold text-gray-500">{{ prod.category }}</span>
                  </td>
                  <td class="px-8 py-6 font-black text-[#1a2e1a]">{{ prod.price }} DT</td>
                  <td class="px-8 py-6">
                    @if (prod.rental) {
                      <span class="px-3 py-1 bg-purple-50 text-purple-600 rounded-full text-[9px] font-black uppercase tracking-tighter">{{ prod.rental }} DT/wk</span>
                    } @else {
                      <span class="text-gray-300">‚Äî</span>
                    }
                  </td>
                  <td class="px-8 py-6 text-center font-black"
                      [ngClass]="prod.stock < 15 ? 'text-red-500' : 'text-emerald-500'">{{ prod.stock }}</td>
                  <td class="px-8 py-6 text-center">
                    <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border"
                          [ngClass]="prod.status === 'Active' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : 'bg-gray-50 text-gray-500 border-gray-200'">
                      {{ prod.status === 'Active' ? '‚úì Active' : '‚úï Inactive' }}
                    </span>
                  </td>
                  <td class="px-8 py-6 text-right">
                    <div class="flex gap-2 justify-end opacity-40 group-hover:opacity-100 transition-opacity">
                      <button (click)="openEditProduct(prod)" class="p-2 hover:text-[#2C4A3C]" title="Edit">‚úèÔ∏è</button>
                      <button (click)="deleteProduct(prod.id)" class="p-2 hover:text-red-500" title="Delete">üóëÔ∏è</button>
                    </div>
                  </td>
                </tr>
              }
              @if (!filteredProducts.length) {
                <tr><td colspan="8" class="text-center py-16 text-gray-400 font-bold">No products found.</td></tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  }

  <!-- ===== INVENTORY ===== -->
  @if (activePortalSection === 'inventory') {
    <div class="space-y-6">
      <div class="flex bg-white/50 p-1 rounded-xl border border-gray-100 shadow-sm max-w-fit">
        <button (click)="activeInventoryTab = 'stock'"
                class="px-8 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center gap-2"
                [ngClass]="activeInventoryTab === 'stock' ? 'bg-[#2C4A3C] text-white shadow-lg' : 'text-gray-500 hover:bg-white'">
          <span class="text-xs">üì¶</span> Stock Levels
        </button>
        <button (click)="activeInventoryTab = 'movements'"
                class="px-8 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center gap-2"
                [ngClass]="activeInventoryTab === 'movements' ? 'bg-[#2C4A3C] text-white shadow-lg' : 'text-gray-500 hover:bg-white'">
          <span class="text-xs">üìú</span> Stock Movements
        </button>
        <button (click)="activeInventoryTab = 'warehouses'"
                class="px-8 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center gap-2"
                [ngClass]="activeInventoryTab === 'warehouses' ? 'bg-[#2C4A3C] text-white shadow-lg' : 'text-gray-500 hover:bg-white'">
          <span class="text-xs">üè¢</span> Warehouses
        </button>
      </div>

      <div class="bg-amber-50/50 border border-amber-100 rounded-3xl p-8 flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center text-2xl shadow-sm">‚öôÔ∏è</div>
          <div>
            <h4 class="font-black text-amber-900 text-lg leading-tight">Global Stock Alert Configuration</h4>
            <p class="text-sm text-amber-700 font-medium italic">Set a default minimum stock threshold for all products</p>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <input type="number" [(ngModel)]="globalAlertThreshold" min="0"
                 class="w-20 px-4 py-3 bg-white border border-amber-200 rounded-xl text-center font-black focus:outline-none">
          <button (click)="applyGlobalAlert()"
                  class="px-6 py-3 bg-[#E67E22] text-white rounded-xl text-sm font-black uppercase tracking-widest hover:brightness-110 transition-all">Apply to All</button>
        </div>
      </div>

      @if (lowStockCount > 0) {
        <div class="bg-red-50/50 border border-red-100 rounded-2xl p-6 flex flex-col gap-2">
          <div class="flex items-center gap-2 text-red-600">
            <span class="text-lg">‚ö†Ô∏è</span>
            <span class="text-sm font-black uppercase tracking-widest">{{ lowStockCount }} item(s) below threshold</span>
          </div>
          @for (item of inventory; track item.id) {
            @if (item.status === 'low') {
              <p class="text-xs font-bold text-red-400 italic">{{ item.productName }} ({{ item.current }} left)</p>
            }
          }
        </div>
      }

      <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
            <tr class="bg-gray-50/50 border-b border-gray-100 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">
              <th class="px-8 py-5">Product</th>
              <th class="px-8 py-5">Location</th>
              <th class="px-8 py-5 text-center">Current</th>
              <th class="px-8 py-5 text-center">Reserved</th>
              <th class="px-8 py-5 text-center">Available</th>
              <th class="px-8 py-5 text-center">Alert At</th>
              <th class="px-8 py-5 text-center">Status</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
              @for (item of inventory; track item.id) {
                <tr class="hover:bg-gray-50/30 transition-colors">
                  <td class="px-8 py-6 font-bold text-[#1a2e1a]">{{ item.productName }}</td>
                  <td class="px-8 py-6">
                    <p class="text-xs font-bold text-gray-400">{{ item.warehouse }}</p>
                    <p class="text-[10px] font-black text-gray-300 uppercase">{{ item.location }}</p>
                  </td>
                  <td class="px-8 py-6 text-center font-black text-[#1a2e1a]">{{ item.current }}</td>
                  <td class="px-8 py-6 text-center font-black text-gray-400">{{ item.reserved }}</td>
                  <td class="px-8 py-6 text-center font-black text-emerald-600">{{ item.available }}</td>
                  <td class="px-8 py-6 text-center font-black text-amber-600">{{ item.alertAt }}</td>
                  <td class="px-8 py-6 text-center">
                    <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border"
                          [ngClass]="item.status === 'ok' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : 'bg-amber-50 text-amber-600 border-amber-100'">
                      ‚Ä¢ {{ item.status === 'ok' ? 'OK' : 'Low' }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ===== ORDERS ===== -->
  @if (activePortalSection === 'orders') {
    <div class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm text-center hover:border-[#1a2e1a] transition-all">
          <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-2">Total Orders</p>
          <p class="text-3xl font-black text-[#1a2e1a]">{{ totalOrders }}</p>
        </div>
        <div class="bg-amber-50/50 p-6 rounded-2xl border border-amber-100 shadow-sm text-center hover:border-amber-400 transition-all">
          <p class="text-[10px] font-black text-amber-600 uppercase tracking-[0.2em] mb-2">Pending</p>
          <p class="text-3xl font-black text-amber-700">{{ pendingOrders }}</p>
        </div>
        <div class="bg-emerald-50/50 p-6 rounded-2xl border border-emerald-100 shadow-sm text-center hover:border-emerald-400 transition-all">
          <p class="text-[10px] font-black text-emerald-600 uppercase tracking-[0.2em] mb-2">Revenue</p>
          <p class="text-3xl font-black text-emerald-700 italic">{{ totalRevenue | number:'1.2-2' }} DT</p>
        </div>
        <div class="bg-indigo-50/50 p-6 rounded-2xl border border-indigo-100 shadow-sm text-center hover:border-indigo-400 transition-all">
          <p class="text-[10px] font-black text-indigo-600 uppercase tracking-[0.2em] mb-2">Delivered</p>
          <p class="text-3xl font-black text-indigo-700">{{ gearOrders.length - pendingOrders }}</p>
        </div>
      </div>

      <div class="flex flex-wrap gap-2 bg-white/50 p-1.5 rounded-2xl border border-gray-100 shadow-sm">
        @for (status of ['All', 'Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled']; track status) {
          <button (click)="filterOrders(status)"
                  class="px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all"
                  [ngClass]="selectedOrderStatus === status ? 'bg-[#2C4A3C] text-white shadow-lg' : 'text-gray-400 hover:text-[#1a2e1a] hover:bg-white'">
            {{ status }}
          </button>
        }
      </div>

      <div class="space-y-6">
        @for (order of filteredOrders; track order.id) {
          <div class="bg-white rounded-[2rem] border border-gray-100 shadow-sm overflow-hidden hover:shadow-xl transition-all group">
            <div class="p-8 border-b border-gray-50 flex justify-between items-start">
              <div class="flex items-center gap-5">
                <div class="w-12 h-12 bg-[#f8f5e6] rounded-xl flex items-center justify-center text-2xl shadow-inner group-hover:rotate-3 transition-transform">üìã</div>
                <div>
                  <h4 class="text-xl font-black text-[#1a2e1a] tracking-tight">Order #{{ order.id }}</h4>
                  <div class="mt-2 flex gap-4">
                    <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">
                      Customer: <span class="text-[#1a2e1a]">{{ order.customer }}</span>
                    </p>
                    <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest italic">
                      Date: <span class="text-indigo-400">{{ order.date }}</span>
                    </p>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <p class="text-2xl font-black text-[#1a2e1a] italic tracking-tighter">{{ order.total | number:'1.2-2' }} DT</p>
                <span class="mt-2 inline-block px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-[0.2em] border"
                      [ngClass]="getOrderStatusClass(order.status)">
                  ‚Ä¢ {{ order.status }}
                </span>
              </div>
            </div>

            <div class="p-8 bg-gray-50/20">
              <div class="mt-4 flex flex-wrap gap-4">
                <div class="px-4 py-3 bg-blue-50/50 rounded-2xl border border-blue-100/50 flex items-center gap-3">
                  <span class="text-blue-500">üìç</span>
                  <p class="text-[10px] font-black text-blue-800 uppercase tracking-tight">{{ order.address }}</p>
                </div>
                <div class="px-4 py-3 bg-indigo-50/50 rounded-2xl border border-indigo-100/50 flex items-center gap-3">
                  <span class="text-indigo-500">üìß</span>
                  <p class="text-[10px] font-black text-indigo-800 lowercase tracking-tight">{{ order.email }}</p>
                </div>
              </div>
            </div>

            <div class="p-6 bg-white border-t border-gray-50 flex flex-wrap gap-3">
              <select [(ngModel)]="selectedOrderStatus_map[order.id]"
                      class="px-4 py-2.5 bg-gray-50 border border-gray-100 rounded-xl text-[10px] font-black uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-[#2C4A3C]/10 transition-all cursor-pointer">
                <option value="pending">Pending</option>
                <option value="processing">Processing</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <button (click)="updateOrderStatus(order.id)"
                      class="px-6 py-2.5 bg-[#2C4A3C] text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-[#1a2e1a] shadow-lg shadow-[#2C4A3C]/10 transition-all active:scale-95">
                Update Status
              </button>
              <div class="flex-1"></div>
              <button (click)="cancelOrder(order.id)"
                      class="px-6 py-2.5 border border-red-50 text-red-400 bg-red-50/30 hover:bg-red-50 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all active:scale-95 italic">
                ‚úï Cancel Order
              </button>
            </div>
          </div>
        }
        @if (!filteredOrders.length) {
          <div class="text-center py-20 text-gray-400">
            <p class="text-4xl mb-4">üìã</p>
            <p class="font-bold">No orders found.</p>
          </div>
        }
      </div>
    </div>
  }

  <!-- ===== RENTALS ===== -->
  @if (activePortalSection === 'rentals_management') {
    <div class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-emerald-50/50 border border-emerald-100 rounded-2xl p-6 flex justify-between items-center">
          <div>
            <p class="text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1">Active Rentals</p>
            <p class="text-3xl font-black text-[#1a2e1a]">{{ activeRentals }}</p>
          </div>
          <div class="w-12 h-12 bg-emerald-500 rounded-xl flex items-center justify-center text-white text-xl">‚úì</div>
        </div>
        <div class="bg-red-50/50 border border-red-100 rounded-2xl p-6 flex justify-between items-center">
          <div>
            <p class="text-[10px] font-black text-red-600 uppercase tracking-widest mb-1">Overdue</p>
            <p class="text-3xl font-black text-[#1a2e1a]">{{ overdueRentals }}</p>
          </div>
          <div class="w-12 h-12 bg-amber-500 rounded-xl flex items-center justify-center text-white text-xl">‚ö†Ô∏è</div>
        </div>
        <div class="bg-blue-50/50 border border-blue-100 rounded-2xl p-6 flex justify-between items-center">
          <div>
            <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-1">Total Revenue</p>
            <p class="text-3xl font-black text-[#1a2e1a]">{{ rentalRevenue | number:'1.0-0' }} DT</p>
          </div>
          <div class="w-12 h-12 bg-amber-600/10 rounded-xl flex items-center justify-center text-2xl">üí∞</div>
        </div>
      </div>

      <div class="flex gap-2">
        @for (f of ['All', 'Active', 'Overdue', 'Completed', 'Cancelled']; track f) {
          <button (click)="filterRentals(f)"
                  class="px-6 py-2 rounded-lg text-xs font-bold transition-all border border-gray-100"
                  [ngClass]="selectedRentalFilter === f ? 'bg-[#2C4A3C] text-white' : 'bg-white text-gray-500 hover:bg-gray-50'">
            {{ f }}
          </button>
        }
      </div>

      <div class="space-y-4">
        @for (res of filteredRentals; track res.id) {
          <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden group hover:shadow-md transition-all">
            <div class="p-8">
              <div class="flex justify-between items-start mb-8">
                <div>
                  <h3 class="font-black text-[#1a2e1a] text-xl leading-tight mb-1">{{ res.id }}</h3>
                  <p class="text-xs font-bold text-gray-400">Product: <span class="text-[#1a2e1a]">{{ res.product }}</span></p>
                  <p class="text-xs font-bold text-gray-400">Customer: <span class="text-[#1a2e1a]">{{ res.customer }}</span></p>
                  <p class="text-xs font-bold text-gray-400">Email: <span class="text-gray-300 italic">{{ res.email }}</span></p>
                </div>
                <div class="flex flex-col items-end">
                  <span class="px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-widest mb-2"
                        [ngClass]="res.status === 'active' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'">
                    {{ res.status }}
                  </span>
                  <span class="text-[11px] font-black"
                        [ngClass]="res.daysLeft < 0 ? 'text-red-500' : 'text-emerald-500'">
                    Days Left: {{ res.daysLeft }}
                  </span>
                </div>
              </div>

              <div class="grid grid-cols-2 md:grid-cols-4 gap-8 py-6 border-t border-gray-50">
                <div>
                  <p class="text-[10px] font-black text-gray-300 uppercase mb-1">Start Date</p>
                  <p class="text-sm font-bold text-[#1a2e1a]">{{ res.startDate }}</p>
                </div>
                <div>
                  <p class="text-[10px] font-black text-gray-300 uppercase mb-1">End Date</p>
                  <p class="text-sm font-bold text-[#1a2e1a]">{{ res.endDate }}</p>
                </div>
                <div>
                  <p class="text-[10px] font-black text-gray-300 uppercase mb-1">Total Cost</p>
                  <p class="text-sm font-black text-[#1a2e1a]">{{ res.total }} DT</p>
                </div>
                <div>
                  <p class="text-[10px] font-black text-gray-300 uppercase mb-1">Deposit</p>
                  <p class="text-sm font-black text-amber-600">{{ res.deposit }} DT (Held)</p>
                </div>
              </div>

              <div class="flex gap-3 pt-6 border-t border-gray-50">
                <button (click)="markRentalReturned(res.id)"
                        class="px-6 py-2.5 bg-emerald-500 text-white rounded-lg text-[10px] font-black uppercase tracking-widest hover:brightness-110 transition-all flex items-center gap-2">
                  <span>‚úì</span> Mark Returned
                </button>
                @if (res.status === 'active') {
                  <button (click)="extendRental(res.id)"
                          class="px-6 py-2.5 bg-purple-500 text-white rounded-lg text-[10px] font-black uppercase tracking-widest hover:brightness-110 transition-all">
                    <span>üìÖ</span> Extend Rental
                  </button>
                } @else {
                  <button (click)="sendReminder(res.id)"
                          class="px-6 py-2.5 bg-orange-500 text-white rounded-lg text-[10px] font-black uppercase tracking-widest hover:brightness-110 transition-all">
                    <span>üîî</span> Send Reminder
                  </button>
                }
              </div>
            </div>
          </div>
        }
        @if (!filteredRentals.length) {
          <div class="text-center py-20 text-gray-400">
            <p class="text-4xl mb-4">üì¶</p>
            <p class="font-bold">No rentals found.</p>
          </div>
        }
      </div>
    </div>
  }

</div>

<!-- Footer -->
<div class="px-8 py-6 border-t border-gray-100 bg-[#1a2e1a] text-white/50 flex justify-between items-center text-[10px] font-black uppercase tracking-widest">
  <div class="flex gap-6">
    <span>Active Skus: {{ products.length }}</span>
    <span class="text-emerald-400">Yield Optimized</span>
  </div>
  <div>
    <span class="italic text-white/20">Operational Ledger Verified</span>
  </div>
</div>
