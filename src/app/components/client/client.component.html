<div class="py-16 px-4 sm:px-6 lg:px-8 bg-sage-green/10 min-h-screen">
  <div class="mx-auto max-w-7xl">

    <!-- Profile Header -->
    <div class="bg-gradient-to-r from-forest-green to-olive-green rounded-xl p-6 mb-8 text-cream-beige">
      <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
        <div class="w-24 h-24 rounded-full bg-cream-beige flex items-center justify-center text-forest-green text-3xl font-bold">
          ğŸ‘¤
        </div>
        <div class="flex-1 text-center md:text-left">
          <h3 class="text-2xl font-bold mb-2">{{ customerName }}</h3>
          <p class="text-sage-green mb-4">{{ customerEmail }}</p>
          <div class="flex flex-wrap gap-4 justify-center md:justify-start">
            <span class="font-semibold">ğŸ’ {{ loyaltyPoints }} Points</span>
            <span class="font-semibold">ğŸ’° ${{ walletBalance.toFixed(2) }} Balance</span>
          </div>
        </div>
        <button (click)="activeTab = 'profile'"
          class="bg-cream-beige text-forest-green px-6 py-2 rounded-lg font-semibold hover:bg-white transition-colors min-h-[44px]">
          Edit Profile
        </button>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="mb-6 flex flex-wrap gap-2">
      <button *ngFor="let item of menuItems"
        (click)="activeTab = item.id"
        class="flex items-center gap-2 px-4 py-2 rounded-lg transition-colors min-h-[44px]"
        [ngClass]="activeTab === item.id ? 'bg-olive-green text-cream-beige' : 'bg-white text-forest-green hover:bg-sage-green/20'">
        <span>{{ item.icon }}</span>
        <span>{{ item.label }}</span>
        <span *ngIf="item.badge" class="ml-1 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">{{ item.badge }}</span>
      </button>
    </div>

    <!-- Main Content Card -->
    <div class="bg-white rounded-xl p-6 shadow-md border border-sage-green/30">

      <!-- ==================== WALLET ==================== -->
      <div *ngIf="activeTab === 'wallet'">
        <h3 class="text-xl font-semibold text-forest-green mb-6">ğŸ’° My Wallet</h3>

        <div class="bg-gradient-to-r from-forest-green to-olive-green rounded-xl p-8 text-cream-beige mb-8">
          <p class="text-sage-green mb-2">Available Balance</p>
          <p class="text-5xl font-bold mb-4">${{ walletBalance.toFixed(2) }}</p>
          <p class="text-sage-green">ğŸ’ {{ loyaltyPoints }} Loyalty Points</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
          <button (click)="showAddFundsModal = true"
            class="flex items-center justify-center gap-2 px-4 py-3 bg-forest-green text-cream-beige rounded-lg hover:bg-olive-green transition-colors min-h-[44px]">
            <span>â•</span><span>Add Funds</span>
          </button>
          <button (click)="showWithdrawModal = true"
            class="flex items-center justify-center gap-2 px-4 py-3 bg-white border-2 border-forest-green text-forest-green rounded-lg hover:bg-sage-green/20 transition-colors min-h-[44px]">
            <span>ğŸ’¸</span><span>Withdraw</span>
          </button>
          <button (click)="showTransferModal = true"
            class="flex items-center justify-center gap-2 px-4 py-3 bg-white border-2 border-forest-green text-forest-green rounded-lg hover:bg-sage-green/20 transition-colors min-h-[44px]">
            <span>ğŸ”„</span><span>Transfer</span>
          </button>
        </div>

        <h4 class="font-semibold text-forest-green mb-4">ğŸ“œ Transaction History</h4>
        <div class="space-y-3">
          <div *ngFor="let tx of walletTransactions"
            class="flex justify-between items-center p-4 border border-sage-green/20 rounded-lg hover:bg-sage-green/5 transition-colors">
            <div class="flex items-center gap-4">
              <div [class]="isCredit(tx.type) ? 'bg-green-100' : 'bg-red-100'"
                class="w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                {{ isCredit(tx.type) ? 'â•' : 'â–' }}
              </div>
              <div>
                <p class="font-medium text-forest-green">{{ tx.description }}</p>
                <p class="text-sm text-olive-green">{{ formatDate(tx.createdAt) }}</p>
              </div>
            </div>
            <div class="text-right">
              <p [class]="isCredit(tx.type) ? 'text-green-600' : 'text-red-600'" class="text-xl font-bold">
                {{ isCredit(tx.type) ? '+' : '-' }}${{ tx.amount.toFixed(2) }}
              </p>
              <span [class]="getStatusBadge(tx.status)" class="text-xs px-2 py-1 rounded-full">{{ tx.status }}</span>
            </div>
          </div>
        </div>
        <div *ngIf="walletTransactions.length === 0" class="text-center py-12 bg-sage-green/5 rounded-lg mt-4">
          <p class="text-4xl mb-2">ğŸ’³</p>
          <p class="text-olive-green">No transactions yet</p>
        </div>
      </div>

      <!-- ==================== ORDERS ==================== -->
      <div *ngIf="activeTab === 'orders'">
        <h3 class="text-xl font-semibold text-forest-green mb-4">ğŸ“¦ My Orders</h3>

        <!-- Order Filter Tabs -->
        <div class="flex flex-wrap gap-2 mb-6">
          <button *ngFor="let status of orderStatuses"
            (click)="selectedOrderStatus = status"
            class="px-4 py-1 rounded-md text-sm border transition-colors"
            [ngClass]="selectedOrderStatus === status
              ? 'bg-forest-green text-cream-beige border-forest-green'
              : 'bg-white text-olive-green border-sage-green/40 hover:border-sage-green'">
            {{ status }}
          </button>
        </div>

        <div class="space-y-6">
          <div *ngFor="let order of filteredOrders" class="bg-white border border-sage-green/20 rounded-lg p-6 shadow-sm">
            <!-- Order Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 pb-4 border-b border-sage-green/10">
              <div>
                <h4 class="font-bold text-lg text-forest-green">Order #{{ order.id }}</h4>
                <div class="text-sm text-olive-green">Placed on {{ formatDate(order.createdAt) }}</div>
                <div *ngIf="order.trackingNumber" class="text-sm text-olive-green mt-1">
                  ğŸ“ Tracking: {{ order.trackingNumber }}
                </div>
              </div>
              <div class="text-right mt-2 md:mt-0">
                <div class="font-bold text-xl text-forest-green">${{ order.totalAmount.toFixed(2) }}</div>
                <span class="inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mt-1"
                  [class]="getOrderStatusBadge(order.status)">
                  {{ order.status }}
                </span>
              </div>
            </div>

            <!-- Order Items -->
            <div class="space-y-4 mb-6">
              <div *ngFor="let item of order.items" class="flex items-center gap-4">
                <div class="w-16 h-16 rounded-md bg-sage-green/20 flex items-center justify-center text-2xl shrink-0">ğŸ“¦</div>
                <div class="flex-1">
                  <h5 class="font-semibold text-forest-green">{{ item.productName }}</h5>
                  <div class="text-sm text-olive-green">Qty: {{ item.quantity }}</div>
                  <span *ngIf="item.type === 'RENTAL'" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">
                    ğŸ“… {{ item.rentalDays }} days rental
                  </span>
                </div>
                <div class="font-bold text-forest-green">${{ item.price.toFixed(2) }}</div>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex flex-wrap gap-3">
              <button *ngIf="order.status === 'SHIPPED'" (click)="trackOrder(order)"
                class="flex items-center gap-2 px-4 py-2 bg-forest-green text-cream-beige rounded-md text-sm hover:bg-olive-green transition-colors">
                ğŸ“ Track Package
              </button>
              <button *ngIf="order.status === 'DELIVERED'"
                class="flex items-center gap-2 px-4 py-2 bg-forest-green text-cream-beige rounded-md text-sm hover:bg-olive-green transition-colors">
                â­ Leave Review
              </button>
              <button *ngIf="order.status === 'PENDING'" (click)="cancelOrder(order)"
                class="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition-colors">
                âŒ Cancel Order
              </button>
              <button (click)="downloadInvoice(order)"
                class="flex items-center gap-2 px-4 py-2 border border-sage-green/40 text-olive-green rounded-md text-sm hover:bg-sage-green/10 transition-colors">
                ğŸ“„ Download Invoice
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="filteredOrders.length === 0" class="text-center py-12">
          <p class="text-4xl mb-2">ğŸ“¦</p>
          <p class="text-olive-green mb-4">No orders found</p>
          <a routerLink="/marketplace" class="inline-block bg-forest-green text-cream-beige px-6 py-3 rounded-lg hover:bg-olive-green">Start Shopping</a>
        </div>
      </div>

      <!-- ==================== CART ==================== -->
      <div *ngIf="activeTab === 'cart'">
        <h3 class="text-xl font-semibold text-forest-green mb-6">ğŸ›’ Shopping Cart</h3>

        <div *ngIf="cartItems.length > 0">
          <div class="space-y-4 mb-8">
            <div *ngFor="let item of cartItems; let i = index"
              class="flex gap-4 p-4 border border-sage-green/20 rounded-lg">
              <img [src]="item.image" [alt]="item.productName" class="w-24 h-24 object-cover rounded-lg">
              <div class="flex-1">
                <h4 class="font-bold text-forest-green">{{ item.productName }}</h4>
                <p class="text-olive-green text-sm mb-2">
                  {{ item.type === 'RENTAL' ? 'ğŸ“… Rental: ' + item.rentalDays + ' days' : 'ğŸ›ï¸ Purchase' }}
                </p>
                <div class="flex items-center gap-4">
                  <div class="flex items-center gap-2">
                    <button (click)="updateQuantity(i, -1)" class="w-8 h-8 bg-sage-green/20 rounded-lg hover:bg-sage-green/40">-</button>
                    <span class="font-bold text-forest-green w-8 text-center">{{ item.quantity }}</span>
                    <button (click)="updateQuantity(i, 1)" class="w-8 h-8 bg-sage-green/20 rounded-lg hover:bg-sage-green/40">+</button>
                  </div>
                  <p class="font-bold text-forest-green">${{ (item.price * item.quantity).toFixed(2) }}</p>
                </div>
              </div>
              <button (click)="removeFromCart(i)" class="text-red-500 hover:text-red-700">ğŸ—‘ï¸</button>
            </div>
          </div>

          <!-- Cart Summary -->
          <div class="bg-sage-green/10 rounded-lg p-6 mb-6">
            <div class="space-y-3">
              <div class="flex justify-between"><span class="text-olive-green">Subtotal:</span><span class="font-bold text-forest-green">${{ cartSubtotal.toFixed(2) }}</span></div>
              <div class="flex justify-between"><span class="text-olive-green">Shipping:</span><span class="font-bold text-forest-green">${{ shippingCost.toFixed(2) }}</span></div>
              <div class="flex justify-between"><span class="text-olive-green">Tax (10%):</span><span class="font-bold text-forest-green">${{ cartTax.toFixed(2) }}</span></div>
              <div class="border-t border-sage-green/20 pt-3 flex justify-between items-center">
                <span class="text-xl font-bold text-forest-green">Total:</span>
                <span class="text-3xl font-bold text-forest-green">${{ cartTotal.toFixed(2) }}</span>
              </div>
              <div class="flex justify-between items-center text-sm">
                <span class="text-olive-green">ğŸ’ Points to earn:</span>
                <span class="font-bold text-purple-600">{{ Math.floor(cartTotal) }} points</span>
              </div>
            </div>
          </div>

          <!-- Shipping Address -->
          <div class="mb-6">
            <h4 class="font-semibold text-forest-green mb-4">ğŸ“ Shipping Address</h4>
            <div class="bg-sage-green/10 rounded-lg p-4">
              <label class="block text-sm font-medium text-forest-green mb-2">Delivery Address *</label>
              <textarea
                [(ngModel)]="shippingAddress"
                name="shippingAddress"
                rows="3"
                class="w-full px-4 py-3 border border-sage-green/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-forest-green/50 resize-none"
                placeholder="Enter your full shipping address (Street, City, State, ZIP Code, Country)"></textarea>
              <p *ngIf="!shippingAddress" class="text-sm text-red-500 mt-1">âš ï¸ Shipping address is required for checkout</p>
              <div class="mt-3 flex items-start gap-2">
                <input type="checkbox" id="saveAddress" class="mt-1">
                <label for="saveAddress" class="text-sm text-olive-green">Save this address for future orders</label>
              </div>
            </div>
          </div>

          <!-- Payment Method -->
          <div class="mb-6">
            <h4 class="font-semibold text-forest-green mb-4">ğŸ’³ Payment Method</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <button (click)="selectedPaymentMethod = 'wallet'"
                class="p-4 border-2 rounded-lg transition-colors"
                [ngClass]="selectedPaymentMethod === 'wallet' ? 'border-forest-green bg-forest-green text-cream-beige' : 'border-sage-green/40 text-forest-green hover:border-forest-green'">
                <div class="flex items-center gap-3">
                  <span class="text-2xl">ğŸ’°</span>
                  <div class="text-left">
                    <p class="font-bold">CampConnect Wallet</p>
                    <p class="text-sm">Balance: ${{ walletBalance.toFixed(2) }}</p>
                  </div>
                </div>
              </button>
              <button (click)="selectedPaymentMethod = 'card'"
                class="p-4 border-2 rounded-lg transition-colors"
                [ngClass]="selectedPaymentMethod === 'card' ? 'border-forest-green bg-forest-green text-cream-beige' : 'border-sage-green/40 text-forest-green hover:border-forest-green'">
                <div class="flex items-center gap-3">
                  <span class="text-2xl">ğŸ’³</span>
                  <div class="text-left">
                    <p class="font-bold">Credit/Debit Card</p>
                    <p class="text-sm">Secure payment</p>
                  </div>
                </div>
              </button>
            </div>
          </div>

          <div class="flex gap-4">
            <button (click)="checkout()"
              [disabled]="!shippingAddress || (selectedPaymentMethod === 'wallet' && walletBalance < cartTotal)"
              class="flex-1 bg-forest-green text-cream-beige py-4 rounded-lg hover:bg-olive-green transition-colors font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]">
              <span *ngIf="!shippingAddress">ğŸ“ Enter Shipping Address</span>
              <span *ngIf="shippingAddress && selectedPaymentMethod === 'wallet' && walletBalance < cartTotal">âš ï¸ Insufficient Balance</span>
              <span *ngIf="shippingAddress && !(selectedPaymentMethod === 'wallet' && walletBalance < cartTotal)">âœ… Proceed to Checkout</span>
            </button>
            <button (click)="clearCart()" class="px-6 bg-red-500 text-white py-4 rounded-lg hover:bg-red-600 transition-colors">ğŸ—‘ï¸ Clear</button>
          </div>
        </div>

        <div *ngIf="cartItems.length === 0" class="text-center py-12">
          <p class="text-4xl mb-2">ğŸ›’</p>
          <p class="text-olive-green mb-4">Your cart is empty</p>
          <a routerLink="/marketplace" class="inline-block bg-forest-green text-cream-beige px-6 py-3 rounded-lg hover:bg-olive-green">Continue Shopping</a>
        </div>
      </div>

      <!-- ==================== PROFILE ==================== -->
      <div *ngIf="activeTab === 'profile'">
        <h3 class="text-xl font-semibold text-forest-green mb-6">âš™ï¸ Profile Settings</h3>
        <form class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-forest-green mb-2">Full Name</label>
              <input type="text" [(ngModel)]="customerName" name="name" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-forest-green/40">
            </div>
            <div>
              <label class="block text-sm font-medium text-forest-green mb-2">Email</label>
              <input type="email" [(ngModel)]="customerEmail" name="email" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-forest-green/40">
            </div>
            <div>
              <label class="block text-sm font-medium text-forest-green mb-2">Phone</label>
              <input type="tel" [(ngModel)]="customerPhone" name="phone" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-forest-green/40">
            </div>
            <div>
              <label class="block text-sm font-medium text-forest-green mb-2">Country</label>
              <input type="text" [(ngModel)]="customerCountry" name="country" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-forest-green/40">
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-forest-green mb-2">Shipping Address</label>
            <textarea [(ngModel)]="customerAddress" name="address" rows="3" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-forest-green/40"></textarea>
          </div>
          <button type="button" (click)="saveProfile()"
            class="bg-olive-green text-cream-beige px-6 py-3 rounded-lg hover:bg-forest-green transition-colors min-h-[44px]">
            ğŸ’¾ Save Changes
          </button>
        </form>
      </div>

    </div>
  </div>
</div>

<!-- ADD FUNDS MODAL -->
<div *ngIf="showAddFundsModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" (click)="showAddFundsModal = false">
  <div class="bg-white rounded-xl max-w-md w-full p-6" (click)="$event.stopPropagation()">
    <h2 class="text-2xl font-bold text-forest-green mb-4">â• Add Funds to Wallet</h2>
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-forest-green mb-2">Amount</label>
        <input type="number" [(ngModel)]="addFundsAmount" min="10" step="10" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg">
      </div>
      <div class="grid grid-cols-3 gap-2">
        <button *ngFor="let amount of [50, 100, 200]" (click)="addFundsAmount = amount"
          class="bg-sage-green/20 text-forest-green py-2 rounded-lg hover:bg-sage-green/40">${{ amount }}</button>
      </div>
      <div>
        <label class="block text-sm font-medium text-forest-green mb-2">Payment Method</label>
        <select [(ngModel)]="fundingSource" class="w-full px-4 py-2 border border-sage-green/40 rounded-lg">
          <option value="CARD">ğŸ’³ Credit/Debit Card</option>
          <option value="BANK_TRANSFER">ğŸ¦ Bank Transfer</option>
        </select>
      </div>
      <div class="flex gap-4">
        <button (click)="confirmAddFunds()" class="flex-1 bg-forest-green text-cream-beige py-3 rounded-lg hover:bg-olive-green transition-colors">âœ… Add Funds</button>
        <button (click)="showAddFundsModal = false" class="px-6 bg-gray-100 text-forest-green py-3 rounded-lg hover:bg-gray-200 transition-colors">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- CHECKOUT SUCCESS MODAL -->
<div *ngIf="showCheckoutSuccess" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-xl max-w-md w-full p-8 text-center">
    <div class="text-6xl mb-4">âœ…</div>
    <h2 class="text-2xl font-bold text-forest-green mb-4">Order Placed Successfully!</h2>
    <p class="text-olive-green mb-6">Your order #{{ latestOrderId }} has been confirmed</p>
    <div class="bg-sage-green/10 rounded-lg p-4 mb-6">
      <p class="text-sm text-olive-green mb-2">Earned Rewards:</p>
      <p class="text-2xl font-bold text-purple-600">+{{ lastEarnedPoints }} Points</p>
    </div>
    <div class="flex gap-4">
      <button (click)="showCheckoutSuccess = false; activeTab = 'orders'" class="flex-1 bg-forest-green text-cream-beige py-3 rounded-lg hover:bg-olive-green transition-colors">View Orders</button>
      <button (click)="showCheckoutSuccess = false" routerLink="/marketplace" class="flex-1 bg-white border border-forest-green text-forest-green py-3 rounded-lg hover:bg-sage-green/20 transition-colors">Continue Shopping</button>
    </div>
  </div>
</div>